<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Veritas Foresight</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
<style>
:root {
    --bg:       #0e1117;
    --surface:  #161b26;
    --border:   #252d3d;
    --dim:      #3a4560;
    --text:     #e8ecf4;
    --muted:    #8896b0;
    --accent:   #5fb8ff;
    --gold:     #e0b84a;
    --danger:   #ff6060;
    --green:    #50ffaa;
    --mono:     'Share Tech Mono', monospace;
    --serif:    'Cormorant Garamond', serif;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--mono);
    font-size: 14px;
    min-height: 100vh;
    overflow-x: hidden;
}

/* ‚îÄ‚îÄ Starfield background ‚îÄ‚îÄ */
body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
        radial-gradient(1px 1px at 20% 30%, rgba(74,158,255,0.15) 0%, transparent 100%),
        radial-gradient(1px 1px at 80% 10%, rgba(200,168,75,0.1) 0%, transparent 100%),
        radial-gradient(1px 1px at 50% 70%, rgba(74,158,255,0.08) 0%, transparent 100%),
        radial-gradient(1px 1px at 10% 80%, rgba(200,168,75,0.06) 0%, transparent 100%);
    pointer-events: none;
    z-index: 0;
}

.wrap {
    position: relative;
    z-index: 1;
    max-width: 860px;
    margin: 0 auto;
    padding: 40px 20px 80px;
}

/* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
.header {
    text-align: center;
    margin-bottom: 48px;
}

.header-eye {
    font-size: 32px;
    display: block;
    margin-bottom: 12px;
    animation: pulse 4s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.6; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.05); }
}

.header-title {
    font-family: var(--serif);
    font-size: 36px;
    font-weight: 300;
    font-style: italic;
    color: var(--gold);
    letter-spacing: 0.05em;
    margin-bottom: 6px;
}

.header-sub {
    color: var(--muted);
    font-size: 11px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
}

.header-version {
    display: inline-block;
    margin-top: 10px;
    padding: 2px 8px;
    border: 1px solid var(--dim);
    color: var(--muted);
    font-size: 10px;
    letter-spacing: 0.15em;
}

/* ‚îÄ‚îÄ Philosophy quote ‚îÄ‚îÄ */
.quote {
    border-left: 2px solid var(--gold);
    padding: 12px 20px;
    margin-bottom: 36px;
    color: #b0bdd4;
    font-family: var(--serif);
    font-style: italic;
    font-size: 16px;
    line-height: 1.6;
    background: rgba(200,168,75,0.03);
}

/* ‚îÄ‚îÄ Field status bar ‚îÄ‚îÄ */
.field-bar {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 10px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    margin-bottom: 24px;
    font-size: 12px;
    color: var(--text);
}

.field-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--muted);
    flex-shrink: 0;
}
.field-dot.live { background: var(--green); animation: blink 2s infinite; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

.field-topics {
    flex: 1;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
}

.field-crisis {
    flex-shrink: 0;
    color: var(--text);
}
.field-crisis.high { color: var(--danger); }
.field-crisis.mid { color: var(--gold); }

/* ‚îÄ‚îÄ Input section ‚îÄ‚îÄ */
.input-section {
    margin-bottom: 32px;
}

.input-label {
    display: block;
    margin-bottom: 8px;
    color: var(--muted);
    font-size: 10px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
}

textarea {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--mono);
    font-size: 13px;
    padding: 14px 16px;
    resize: vertical;
    min-height: 80px;
    line-height: 1.6;
    outline: none;
    transition: border-color 0.2s;
}
textarea:focus { border-color: var(--dim); }
textarea::placeholder { color: var(--muted); }

.controls {
    display: flex;
    gap: 12px;
    margin-top: 12px;
    align-items: center;
    flex-wrap: wrap;
}

.ctrl-group {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--muted);
    font-size: 11px;
}

.ctrl-group label { white-space: nowrap; }

input[type=range] {
    -webkit-appearance: none;
    width: 80px;
    height: 2px;
    background: var(--dim);
    outline: none;
}
input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 10px; height: 10px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
}

.steps-val {
    color: var(--accent);
    min-width: 12px;
}

.toggle {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    color: var(--muted);
}
.toggle input { display: none; }
.toggle-track {
    width: 28px; height: 14px;
    background: var(--dim);
    border-radius: 7px;
    position: relative;
    transition: background 0.2s;
}
.toggle input:checked ~ .toggle-track { background: var(--accent); }
.toggle-thumb {
    position: absolute;
    top: 2px; left: 2px;
    width: 10px; height: 10px;
    border-radius: 50%;
    background: #fff;
    transition: left 0.2s;
}
.toggle input:checked ~ .toggle-track .toggle-thumb { left: 16px; }

.btn-run {
    margin-left: auto;
    padding: 8px 28px;
    background: transparent;
    border: 1px solid var(--accent);
    color: var(--accent);
    font-family: var(--mono);
    font-size: 12px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
}
.btn-run:hover { background: var(--accent); color: var(--bg); }
.btn-run:disabled { opacity: 0.3; cursor: not-allowed; }

/* ‚îÄ‚îÄ Loading ‚îÄ‚îÄ */
.loading {
    display: none;
    text-align: center;
    padding: 40px;
    color: var(--muted);
}
.loading.show { display: block; }
.loading-spinner {
    display: inline-block;
    width: 20px; height: 20px;
    border: 1px solid var(--dim);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 12px;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ‚îÄ‚îÄ Results ‚îÄ‚îÄ */
.results { display: none; }
.results.show { display: block; }

/* ‚îÄ‚îÄ Final state ‚îÄ‚îÄ */
.state-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    margin-bottom: 24px;
    overflow: hidden;
}

.state-header {
    padding: 10px 16px;
    background: rgba(74,158,255,0.05);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
}

.state-dominant {
    color: var(--accent);
    font-family: var(--serif);
    font-style: italic;
    font-size: 16px;
}

.state-entropy {
    font-size: 10px;
    color: var(--muted);
}

.futures-grid {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.future-row {
    display: grid;
    grid-template-columns: 160px 1fr 50px;
    align-items: center;
    gap: 12px;
    font-size: 11px;
}

.future-name {
    color: var(--text);
    font-size: 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.future-bar-wrap {
    height: 4px;
    background: var(--dim);
    border-radius: 2px;
    overflow: hidden;
}

.future-bar {
    height: 100%;
    background: var(--accent);
    border-radius: 2px;
    transition: width 0.6s ease;
}
.future-bar.dominant { background: var(--gold); }

.future-pct {
    text-align: right;
    color: var(--muted);
    font-size: 11px;
}
.future-pct.dominant { color: var(--gold); }

/* ‚îÄ‚îÄ History ‚îÄ‚îÄ */
.history-title {
    font-size: 10px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 12px;
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 32px;
}

.snap {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 12px 16px;
    display: grid;
    grid-template-columns: 32px 1fr;
    gap: 12px;
    align-items: start;
    transition: border-color 0.2s;
}
.snap:hover { border-color: var(--dim); }

.snap-num {
    color: var(--muted);
    font-size: 10px;
    padding-top: 2px;
    text-align: right;
}

.snap-body {}

.snap-realized {
    color: var(--gold);
    font-size: 13px;
    margin-bottom: 4px;
}

.snap-arg {
    color: var(--text);
    font-size: 11px;
    margin-bottom: 4px;
    line-height: 1.4;
}

.snap-feedback {
    color: var(--muted);
    font-size: 10px;
    font-style: italic;
    border-left: 1px solid var(--dim);
    padding-left: 8px;
    margin-top: 6px;
    line-height: 1.4;
}

/* ‚îÄ‚îÄ Field context panel ‚îÄ‚îÄ */
.field-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 14px 16px;
    margin-bottom: 24px;
    font-size: 11px;
}

.field-panel-title {
    color: var(--muted);
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-bottom: 10px;
}

.field-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.field-tag {
    padding: 2px 8px;
    border: 1px solid var(--dim);
    color: var(--muted);
    font-size: 10px;
    letter-spacing: 0.1em;
}

.crisis-meter {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
    font-size: 10px;
    color: var(--muted);
}
.crisis-bar-wrap {
    flex: 1;
    height: 2px;
    background: var(--dim);
}
.crisis-bar {
    height: 100%;
    background: var(--green);
    transition: width 0.6s ease;
}
.crisis-bar.mid { background: var(--gold); }
.crisis-bar.high { background: var(--danger); }

/* ‚îÄ‚îÄ Error ‚îÄ‚îÄ */
.error-msg {
    display: none;
    padding: 12px 16px;
    border: 1px solid var(--danger);
    color: var(--danger);
    margin-bottom: 16px;
    font-size: 12px;
}
.error-msg.show { display: block; }

/* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
.footer {
    text-align: center;
    margin-top: 60px;
    color: var(--muted);
    font-size: 10px;
    letter-spacing: 0.15em;
    line-height: 2;
}
.footer a { color: var(--dim); text-decoration: none; }
.footer a:hover { color: var(--muted); }

/* ‚îÄ‚îÄ Futures management ‚îÄ‚îÄ */
.futures-mgmt {
    margin-bottom: 28px;
}

.futures-mgmt-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
}

.futures-mgmt-title {
    font-size: 10px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
}

.btn-add-future {
    padding: 4px 12px;
    background: transparent;
    border: 1px solid var(--dim);
    color: var(--muted);
    font-family: var(--mono);
    font-size: 10px;
    letter-spacing: 0.1em;
    cursor: pointer;
    transition: all 0.2s;
}
.btn-add-future:hover { border-color: var(--accent); color: var(--accent); }

.futures-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.future-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    background: var(--surface);
    border: 1px solid var(--border);
    transition: border-color 0.2s;
}
.future-item:hover { border-color: var(--dim); }
.future-item.inactive { opacity: 0.4; }

.future-item-name {
    flex: 1;
    font-size: 12px;
    color: var(--text);
}

.future-item-desc {
    font-size: 10px;
    color: var(--muted);
    flex: 2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.future-item-badge {
    font-size: 9px;
    padding: 1px 6px;
    border: 1px solid var(--dim);
    color: var(--muted);
    letter-spacing: 0.1em;
    flex-shrink: 0;
}
.future-item-badge.custom { border-color: var(--gold); color: var(--gold); }

.future-item-toggle {
    cursor: pointer;
    font-size: 11px;
    color: var(--muted);
    flex-shrink: 0;
    padding: 2px 6px;
    border: 1px solid transparent;
    background: transparent;
    font-family: var(--mono);
    transition: all 0.2s;
}
.future-item-toggle:hover { border-color: var(--dim); }
.future-item.inactive .future-item-toggle { color: var(--green); }

.future-item-del {
    cursor: pointer;
    color: var(--danger);
    font-size: 11px;
    flex-shrink: 0;
    padding: 2px 6px;
    border: 1px solid transparent;
    background: transparent;
    font-family: var(--mono);
    opacity: 0.5;
    transition: opacity 0.2s;
}
.future-item-del:hover { opacity: 1; }

/* ‚îÄ‚îÄ Add future form ‚îÄ‚îÄ */
.add-form {
    display: none;
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 16px;
    margin-top: 10px;
    flex-direction: column;
    gap: 10px;
}
.add-form.show { display: flex; }

.form-row {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.form-label {
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 0.1em;
    text-transform: uppercase;
}

.form-input {
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--mono);
    font-size: 12px;
    padding: 7px 10px;
    outline: none;
    transition: border-color 0.2s;
}
.form-input:focus { border-color: var(--dim); }
.form-input::placeholder { color: var(--muted); }

.form-hint {
    font-size: 10px;
    color: var(--muted);
    margin-top: 2px;
}

.form-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    margin-top: 4px;
}

.btn-save {
    padding: 6px 20px;
    background: transparent;
    border: 1px solid var(--accent);
    color: var(--accent);
    font-family: var(--mono);
    font-size: 11px;
    letter-spacing: 0.1em;
    cursor: pointer;
    transition: all 0.2s;
}
.btn-save:hover { background: var(--accent); color: var(--bg); }

.btn-cancel {
    padding: 6px 14px;
    background: transparent;
    border: 1px solid var(--dim);
    color: var(--muted);
    font-family: var(--mono);
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s;
}
.btn-cancel:hover { border-color: var(--muted); color: var(--text); }


/* ‚îÄ‚îÄ Matched headlines ‚îÄ‚îÄ */
.future-headlines {
    grid-column: 1 / -1;
    display: flex;
    flex-direction: column;
    gap: 3px;
    margin-top: 4px;
    padding-left: 4px;
    border-left: 2px solid var(--border);
}

.headline-item {
    font-size: 10px;
    color: var(--muted);
    line-height: 1.4;
    display: flex;
    gap: 6px;
    align-items: flex-start;
}

.headline-item::before {
    content: '‚Üë';
    color: var(--green);
    flex-shrink: 0;
    font-size: 10px;
}

/* ‚îÄ‚îÄ RSS headlines panel ‚îÄ‚îÄ */
.rss-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 14px 16px;
    margin-bottom: 24px;
}

.rss-panel-title {
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.rss-list {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.rss-item {
    font-size: 11px;
    color: var(--text);
    line-height: 1.4;
    padding: 4px 0;
    border-bottom: 1px solid var(--border);
}
.rss-item:last-child { border-bottom: none; }


/* ‚îÄ‚îÄ Probability chart ‚îÄ‚îÄ */
.chart-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    margin-bottom: 24px;
    overflow: hidden;
}

.chart-header {
    padding: 10px 16px;
    background: rgba(74,158,255,0.04);
    border-bottom: 1px solid var(--border);
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.chart-wrap {
    padding: 16px;
    position: relative;
}

canvas#probabilityChart {
    width: 100%;
    display: block;
}

.chart-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    padding: 0 16px 14px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 10px;
    color: var(--muted);
    cursor: pointer;
    transition: color 0.2s;
}
.legend-item:hover { color: var(--text); }

.legend-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}


/* ‚îÄ‚îÄ Battle mode ‚îÄ‚îÄ */
.mode-tabs {
    display: flex;
    gap: 0;
    margin-bottom: 24px;
    border: 1px solid var(--border);
}

.mode-tab {
    flex: 1;
    padding: 10px;
    text-align: center;
    font-family: var(--mono);
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
    background: var(--surface);
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    border-right: 1px solid var(--border);
}
.mode-tab:last-child { border-right: none; }
.mode-tab.active { background: var(--bg); color: var(--accent); border-bottom: 2px solid var(--accent); }
.mode-tab:hover:not(.active) { color: var(--text); }

.battle-section { display: none; }
.battle-section.show { display: block; }
.simulate-section { display: block; }
.simulate-section.hide { display: none; }

.battle-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
}

.battle-col {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.battle-label {
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    padding: 4px 8px;
    border-left: 3px solid;
}
.battle-label.a { border-color: var(--accent); color: var(--accent); }
.battle-label.b { border-color: var(--gold); color: var(--gold); }

.battle-textarea {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--mono);
    font-size: 12px;
    padding: 10px 12px;
    resize: vertical;
    min-height: 70px;
    line-height: 1.5;
    outline: none;
    transition: border-color 0.2s;
}
.battle-textarea:focus { border-color: var(--dim); }
.battle-textarea::placeholder { color: var(--muted); }

.battle-controls {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 8px;
}

.btn-battle {
    margin-left: auto;
    padding: 8px 28px;
    background: transparent;
    border: 1px solid var(--gold);
    color: var(--gold);
    font-family: var(--mono);
    font-size: 12px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
}
.btn-battle:hover { background: var(--gold); color: var(--bg); }
.btn-battle:disabled { opacity: 0.3; cursor: not-allowed; }

/* Battle results */
.battle-verdict {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 20px;
    margin-bottom: 24px;
    text-align: center;
}

.battle-winner-label {
    font-size: 10px;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 8px;
}

.battle-winner-arg {
    font-family: var(--serif);
    font-style: italic;
    font-size: 20px;
    margin-bottom: 6px;
}
.battle-winner-arg.a { color: var(--accent); }
.battle-winner-arg.b { color: var(--gold); }

.battle-winner-sub {
    font-size: 11px;
    color: var(--muted);
}

.battle-vs {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 16px;
    margin-bottom: 24px;
    align-items: center;
}

.battle-side {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 14px;
}
.battle-side.winner { border-color: var(--green); }

.battle-side-label {
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-bottom: 6px;
}
.battle-side-label.a { color: var(--accent); }
.battle-side-label.b { color: var(--gold); }

.battle-side-text {
    font-size: 12px;
    color: var(--text);
    line-height: 1.4;
}

.battle-vs-divider {
    font-family: var(--serif);
    font-size: 28px;
    color: var(--muted);
    font-style: italic;
    text-align: center;
}


/* ‚îÄ‚îÄ Temperature control ‚îÄ‚îÄ */
.temp-control {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 14px 16px;
    margin-bottom: 16px;
}

.temp-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
}

.temp-title {
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--muted);
}

.temp-value-display {
    font-size: 12px;
    font-weight: bold;
    min-width: 80px;
    text-align: right;
    transition: color 0.3s;
}

.temp-slider-wrap {
    position: relative;
    margin-bottom: 8px;
}

input[type=range].temp-range {
    -webkit-appearance: none;
    width: 100%;
    height: 4px;
    border-radius: 2px;
    outline: none;
    cursor: pointer;
}
input[type=range].temp-range::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px; height: 14px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    transition: background 0.2s;
}

.temp-labels {
    display: flex;
    justify-content: space-between;
    font-size: 9px;
    color: var(--muted);
    letter-spacing: 0.1em;
    margin-bottom: 10px;
}

.temp-explanation {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
    padding: 8px 10px;
    border-left: 2px solid var(--border);
    transition: all 0.3s;
    font-family: var(--serif);
    font-style: italic;
}

</style>
</head>
<body>
<div class="wrap">

    <div class="header">
        <span class="header-eye">üî≠</span>
        <div class="header-title">Veritas Foresight</div>
        <div class="header-sub">Narrative Resonance Simulator</div>
        <div class="header-version">v1.0 ¬∑ part of Veritas Protocol ecosystem</div>
    </div>

    <div class="quote">
        When you define a future, you begin to collapse it into being.<br>
        An argument is not a logical construct ‚Äî it is a vector in the probability space of possible worlds.
    </div>

    <div class="field-bar" id="fieldBar">
        <div class="field-dot" id="fieldDot"></div>
        <div class="field-topics" id="fieldTopics">loading information field...</div>
        <div class="field-crisis" id="fieldCrisis"></div>
    </div>


    <!-- MODE TABS -->
    <div class="mode-tabs">
        <button class="mode-tab active" id="tabSimulate"
            onclick="switchMode('simulate')">‚ñ∂ —Å–∏–º—É–ª—è—Ü—ñ—è</button>
        <button class="mode-tab" id="tabBattle"
            onclick="switchMode('battle')">‚öî –±–∏—Ç–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤</button>
    </div>

    <!-- BATTLE SECTION -->
    <div class="battle-section" id="battleSection">

        <div class="battle-inputs">
            <div class="battle-col">
                <div class="battle-label a">–∞—Ä–≥—É–º–µ–Ω—Ç A</div>
                <textarea class="battle-textarea" id="argA"
                    placeholder="AI regulation will strengthen and slow down tech acceleration"></textarea>
            </div>
            <div class="battle-col">
                <div class="battle-label b">–∞—Ä–≥—É–º–µ–Ω—Ç B</div>
                <textarea class="battle-textarea" id="argB"
                    placeholder="AI will advance faster than any regulation can control"></textarea>
            </div>
        </div>

        <div class="temp-control" style="margin-bottom:12px">
            <div class="temp-header">
                <span class="temp-title">üå° —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</span>
                <span class="temp-value-display" id="battleTempDisplay">–Ω–æ—Ä–º–∞–ª—å–Ω–∞ ¬∑ 1.0</span>
            </div>
            <input type="range" class="temp-range" id="battleTempRange"
                min="0.1" max="2.0" step="0.1" value="1.0"
                oninput="updateBattleTemp(this.value)">
            <div class="temp-labels">
                <span>–¥–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–æ</span>
                <span>–Ω–æ—Ä–º–∞–ª—å–Ω–æ</span>
                <span>—Ö–∞–æ—Å</span>
            </div>
            <div class="temp-explanation" id="battleTempExplanation">
                –ê—Ä–≥—É–º–µ–Ω—Ç–∏ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –°–∏–ª—å–Ω–∏–π –Ω–∞—Ä–∞—Ç–∏–≤ –ø–µ—Ä–µ–º–∞–≥–∞—î, –∞–ª–µ –≤–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è ‚Äî —è–∫ —É —Ä–µ–∞–ª—å–Ω–æ–º—É –∂–∏—Ç—Ç—ñ.
            </div>
        </div>

        <div class="battle-controls">
            <div class="ctrl-group">
                <label>—Ä–∞—É–Ω–¥–∏</label>
                <input type="range" id="battleRounds" min="1" max="10" value="5"
                    oninput="document.getElementById('battleRoundsVal').textContent=this.value">
                <span class="steps-val" id="battleRoundsVal">5</span>
            </div>
            <label class="toggle">
                <input type="checkbox" id="battleUseField" checked>
                <div class="toggle-track"><div class="toggle-thumb"></div></div>
                live field
            </label>
            <button class="btn-battle" id="btnBattle" onclick="runBattle()">
                ‚öî –±–∏—Ç–∏—Å—è
            </button>
        </div>

        <div class="error-msg" id="battleError"></div>
        <div class="loading" id="battleLoading">
            <div class="loading-spinner"></div>
            <div>–∞—Ä–≥—É–º–µ–Ω—Ç–∏ –±'—é—Ç—å—Å—è...</div>
        </div>

        <div id="battleResults" style="display:none">
            <div class="battle-verdict" id="battleVerdict"></div>
            <div class="battle-vs" id="battleVs"></div>
            <div class="chart-panel">
                <div class="chart-header">
                    <span>–µ–≤–æ–ª—é—Ü—ñ—è –ø–æ–ª—è ¬∑ —Ä–∞—É–Ω–¥–∏ A/B</span>
                    <span id="battleChartInfo" style="color:var(--accent)"></span>
                </div>
                <div class="chart-wrap">
                    <canvas id="battleChart" height="220"></canvas>
                </div>
                <div class="chart-legend" id="battleLegend"></div>
            </div>
        </div>

    </div>

    <!-- SIMULATE SECTION (original content wrapped) -->
    <div class="simulate-section" id="simulateSection">

    <!-- FUTURES MANAGEMENT -->
    <div class="futures-mgmt">
        <div class="futures-mgmt-header">
            <span class="futures-mgmt-title">—Å—Ü–µ–Ω–∞—Ä—ñ—ó –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ</span>
            <button class="btn-add-future" onclick="toggleAddForm()">+ –¥–æ–¥–∞—Ç–∏</button>
        </div>
        <div class="futures-list" id="futuresList">
            <div style="color:var(--muted);font-size:11px;padding:8px 0;">–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        </div>
        <div class="add-form" id="addForm">
            <div class="form-row">
                <label class="form-label">–Ω–∞–∑–≤–∞</label>
                <input class="form-input" id="newName" placeholder="Ukraine-Victory" maxlength="40">
            </div>
            <div class="form-row">
                <label class="form-label">–∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞</label>
                <input class="form-input" id="newKeywords" placeholder="victory, peace, rebuild, ukraine, ceasefire">
                <span class="form-hint">—á–µ—Ä–µ–∑ –∫–æ–º—É, –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é</span>
            </div>
            <div class="form-row">
                <label class="form-label">–ª–æ–≥—ñ–∫–∞ —Å—Ü–µ–Ω–∞—Ä—ñ—é</label>
                <input class="form-input" id="newLogic" placeholder="Ukraine wins and rebuilds as democratic state">
            </div>
            <div class="form-row">
                <label class="form-label">–æ–ø–∏—Å (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</label>
                <input class="form-input" id="newDesc" placeholder="Short description for display">
            </div>
            <div class="form-actions">
                <button class="btn-cancel" onclick="toggleAddForm()">—Å–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button class="btn-save" onclick="saveFuture()">–∑–±–µ—Ä–µ–≥—Ç–∏</button>
            </div>
        </div>
    </div>

    <div class="input-section">
        <label class="input-label">Your argument ‚Äî a claim, a narrative, a hypothesis</label>
        <textarea id="argumentInput" rows="3"
            placeholder="e.g. ‚Äî AI regulation will collapse under industry pressure before 2026 ends"></textarea>

        <div class="temp-control">
            <div class="temp-header">
                <span class="temp-title">üå° —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏</span>
                <span class="temp-value-display" id="tempDisplay">–Ω–æ—Ä–º–∞–ª—å–Ω–∞ ¬∑ 1.0</span>
            </div>
            <div class="temp-slider-wrap">
                <input type="range" class="temp-range" id="tempRange"
                    min="0.1" max="2.0" step="0.1" value="1.0"
                    oninput="updateTemp(this.value)">
            </div>
            <div class="temp-labels">
                <span>–¥–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–æ</span>
                <span>–Ω–æ—Ä–º–∞–ª—å–Ω–æ</span>
                <span>—Ö–∞–æ—Å</span>
            </div>
            <div class="temp-explanation" id="tempExplanation">
                –ê—Ä–≥—É–º–µ–Ω—Ç–∏ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –°–∏–ª—å–Ω–∏–π –Ω–∞—Ä–∞—Ç–∏–≤ –ø–µ—Ä–µ–º–∞–≥–∞—î, –∞–ª–µ –≤–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è ‚Äî —è–∫ —É —Ä–µ–∞–ª—å–Ω–æ–º—É –∂–∏—Ç—Ç—ñ.
            </div>
        </div>

        <div class="controls">
            <div class="ctrl-group">
                <label>–∫—Ä–æ–∫–∏</label>
                <input type="range" id="stepsRange" min="1" max="10" value="5"
                    oninput="document.getElementById('stepsVal').textContent=this.value">
                <span class="steps-val" id="stepsVal">5</span>
            </div>

            <label class="toggle">
                <input type="checkbox" id="useField" checked>
                <div class="toggle-track"><div class="toggle-thumb"></div></div>
                live field
            </label>

            <button class="btn-run" id="btnRun" onclick="runSimulation()">
                ‚ñ∂ simulate
            </button>
        </div>
    </div>

    <div class="error-msg" id="errorMsg"></div>
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div>computing resonance field...</div>
    </div>

    <div class="results" id="results">

        <div class="state-panel">
            <div class="state-header">
                <span>probability field ¬∑ final state</span>
                <span class="state-entropy" id="entropyVal"></span>
            </div>
            <div style="padding:14px 16px 6px; font-size:11px; color:var(--muted);">dominant trajectory</div>
            <div style="padding:0 16px 14px;">
                <div class="state-dominant" id="dominantName"></div>
                <div id="dominantDesc" style="font-size:11px;color:var(--muted);margin-top:4px;"></div>
            </div>
            <div class="futures-grid" id="futuresGrid"></div>
        </div>

        <div class="field-panel" id="fieldPanel" style="display:none">
            <div class="field-panel-title">information field context used</div>
            <div class="field-tags" id="fieldTagsResult"></div>
            <div class="crisis-meter">
                <span>crisis level</span>
                <div class="crisis-bar-wrap">
                    <div class="crisis-bar" id="crisisBar" style="width:0%"></div>
                </div>
                <span id="crisisVal">0</span>
            </div>
        </div>

        <div class="rss-panel" id="rssPanel" style="display:none">
            <div class="rss-panel-title">
                <span>üì°</span>
                <span>–ø–æ—Ç–æ—á–Ω—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —â–æ –≤–ø–ª–∏–Ω—É–ª–∏ –Ω–∞ —Ä–µ–∑–æ–Ω–∞–Ω—Å</span>
            </div>
            <div class="rss-list" id="rssList"></div>
        </div>

        <!-- PROBABILITY CHART -->
        <div class="chart-panel" id="chartPanel">
            <div class="chart-header">
                <span>–µ–≤–æ–ª—é—Ü—ñ—è –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π ¬∑ –ø–æ —ñ—Ç–µ—Ä–∞—Ü—ñ—è—Ö</span>
                <span id="chartIterCount" style="color:var(--accent)"></span>
            </div>
            <div class="chart-wrap">
                <canvas id="probabilityChart" height="220"></canvas>
            </div>
            <div class="chart-legend" id="chartLegend"></div>
        </div>

        <div class="history-title">iteration log</div>
        <div class="history-list" id="historyList"></div>

    </div>

    </div><!-- /simulate-section -->

    <div class="footer">
        <div>Veritas Foresight v1.0 ¬∑ does not predict ¬∑ measures resonance</div>
        <div>
            <a href="https://veritas-protocol.onrender.com" target="_blank">Veritas Protocol</a>
            ¬∑ <a href="https://github.com/Architekt-future/veritas-foresight" target="_blank">GitHub</a>
        </div>
    </div>

</div>

<script>
const API = '';  // same origin

// ‚îÄ‚îÄ Load field context on startup ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadField() {
    try {
        const r = await fetch(`${API}/api/field`);
        const d = await r.json();
        if (d.status === 'ok') {
            document.getElementById('fieldDot').classList.add('live');
            const topics = d.hot_topics || [];
            document.getElementById('fieldTopics').textContent =
                topics.length ? topics.join(' ¬∑ ') : 'no dominant topics detected';
            const cl = d.crisis_level || 0;
            const cEl = document.getElementById('fieldCrisis');
            cEl.textContent = `crisis ${cl.toFixed(1)}`;
            cEl.className = 'field-crisis' + (cl >= 6 ? ' high' : cl >= 3 ? ' mid' : '');
        } else {
            document.getElementById('fieldTopics').textContent = 'field unavailable';
        }
    } catch {
        document.getElementById('fieldTopics').textContent = 'field offline';
    }
}

// ‚îÄ‚îÄ Run simulation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function runSimulation() {
    const argument = document.getElementById('argumentInput').value.trim();
    if (!argument) {
        showError('Please enter an argument to simulate.');
        return;
    }

    const steps = parseInt(document.getElementById('stepsRange').value);
    const useField = document.getElementById('useField').checked;

    setLoading(true);
    hideError();
    document.getElementById('results').classList.remove('show');

    try {
        const resp = await fetch(`${API}/api/simulate`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ argument, steps, use_field: useField, temperature: parseFloat(document.getElementById('tempRange').value) }),
        });

        if (!resp.ok) {
            const err = await resp.json();
            throw new Error(err.error || `HTTP ${resp.status}`);
        }

        const data = await resp.json();
        renderResults(data);

    } catch (e) {
        showError(e.message);
    } finally {
        setLoading(false);
    }
}

// ‚îÄ‚îÄ Render results ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderResults(data) {
    const state = data.final_state;
    const history = data.history;
    const fc = data.field_context;

    // Dominant
    document.getElementById('dominantName').textContent = state.dominant;
    const dom = state.futures.find(f => f.name === state.dominant);
    document.getElementById('dominantDesc').textContent = dom ? dom.description : '';

    // Entropy
    const e = state.entropy;
    const maxE = Math.log2(state.futures.length);
    document.getElementById('entropyVal').textContent =
        `entropy ${e.toFixed(3)} / ${maxE.toFixed(3)}`;

    // Futures grid
    const grid = document.getElementById('futuresGrid');
    grid.innerHTML = '';
    state.futures.forEach(f => {
        const isDom = f.name === state.dominant;
        const pct = (f.probability * 100).toFixed(1);
        const headlines = f.matched_headlines || [];
        const headlinesHtml = headlines.length
            ? `<div class="future-headlines">
                ${headlines.map(h => `<div class="headline-item">${esc(h)}</div>`).join('')}
               </div>`
            : '';
        grid.innerHTML += `
            <div class="future-row" style="flex-wrap:wrap">
                <div class="future-name" title="${esc(f.core_logic)}">${esc(f.name)}</div>
                <div class="future-bar-wrap">
                    <div class="future-bar ${isDom ? 'dominant' : ''}"
                         style="width:${pct}%"></div>
                </div>
                <div class="future-pct ${isDom ? 'dominant' : ''}">${pct}%</div>
                ${headlinesHtml}
            </div>`;
    });

    // RSS headlines panel
    const rssPanel = document.getElementById('rssPanel');
    const rssList = document.getElementById('rssList');
    if (fc && fc.headlines && fc.headlines.length) {
        rssPanel.style.display = 'block';
        rssList.innerHTML = fc.headlines.map(h =>
            `<div class="rss-item">${esc(h)}</div>`
        ).join('');
    }

    // Field context
    if (fc && fc.hot_topics && fc.hot_topics.length) {
        document.getElementById('fieldPanel').style.display = 'block';
        const tags = document.getElementById('fieldTagsResult');
        tags.innerHTML = fc.hot_topics.map(t =>
            `<span class="field-tag">${t}</span>`).join('');
        const cl = fc.crisis_level || 0;
        const pct = Math.min(cl * 10, 100);
        const bar = document.getElementById('crisisBar');
        bar.style.width = pct + '%';
        bar.className = 'crisis-bar' + (cl >= 6 ? ' high' : cl >= 3 ? ' mid' : '');
        document.getElementById('crisisVal').textContent = cl.toFixed(1);
    }

    // History
    const list = document.getElementById('historyList');
    list.innerHTML = '';
    history.forEach(snap => {
        const isFirst = snap.iteration === 1;
        list.innerHTML += `
            <div class="snap">
                <div class="snap-num">${snap.iteration}</div>
                <div class="snap-body">
                    <div class="snap-realized">‚Üí ${snap.realized}</div>
                    ${isFirst && snap.argument !== '(internal feedback only)'
                        ? `<div class="snap-arg">‚ü® ${esc(snap.argument)} ‚ü©</div>`
                        : ''}
                    <div class="snap-feedback">${esc(snap.feedback)}</div>
                </div>
            </div>`;
    });

    // Render chart
    if (data.final_state.chart_data) {
        window._lastChartData = data.final_state.chart_data;
        hiddenSeries = new Set();
        renderChart(data.final_state.chart_data);
    }

    document.getElementById('results').classList.add('show');
}

function esc(s) {
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function setLoading(on) {
    document.getElementById('loading').classList.toggle('show', on);
    document.getElementById('btnRun').disabled = on;
}

function showError(msg) {
    const el = document.getElementById('errorMsg');
    el.textContent = '‚ö† ' + msg;
    el.classList.add('show');
}

function hideError() {
    document.getElementById('errorMsg').classList.remove('show');
}

// Enter to submit
document.getElementById('argumentInput').addEventListener('keydown', e => {
    if (e.key === 'Enter' && e.ctrlKey) runSimulation();
});

// Load field on start
loadField();
loadFutures();

// ‚îÄ‚îÄ Futures management ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let allFutures = [];

async function loadFutures() {
    try {
        const r = await fetch(`${API}/api/futures`);
        const d = await r.json();
        allFutures = d.futures || [];
        renderFuturesList();
    } catch {
        document.getElementById('futuresList').innerHTML =
            '<div style="color:var(--muted);font-size:11px;">–Ω–µ –≤–¥–∞–ª–æ—Å—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</div>';
    }
}

function renderFuturesList() {
    const el = document.getElementById('futuresList');
    if (!allFutures.length) {
        el.innerHTML = '<div style="color:var(--muted);font-size:11px;">–Ω–µ–º–∞—î —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤</div>';
        return;
    }
    el.innerHTML = allFutures.map(f => `
        <div class="future-item ${f.is_active ? '' : 'inactive'}" id="fi-${f.id}">
            <div class="future-item-name">${esc(f.name)}</div>
            <div class="future-item-desc">${esc(f.description || f.core_logic)}</div>
            <span class="future-item-badge ${f.is_default ? '' : 'custom'}">
                ${f.is_default ? 'default' : 'custom'}
            </span>
            <button class="future-item-toggle"
                onclick="toggleFuture('${f.id}', ${!f.is_active})">
                ${f.is_active ? '–≤–∏–º–∫' : '—É–≤—ñ–º–∫'}
            </button>
            ${!f.is_default ? `<button class="future-item-del"
                onclick="deleteFuture('${f.id}')">‚úï</button>` : ''}
        </div>
    `).join('');
}

async function toggleFuture(id, isActive) {
    try {
        await fetch(`${API}/api/futures/${id}/toggle`, {
            method: 'PATCH',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({is_active: isActive}),
        });
        await loadFutures();
    } catch(e) {
        showError('–ù–µ –≤–¥–∞–ª–æ—Å—å –∑–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å: ' + e.message);
    }
}

async function deleteFuture(id) {
    if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Å—Ü–µ–Ω–∞—Ä—ñ–π?')) return;
    try {
        await fetch(`${API}/api/futures/${id}`, {method: 'DELETE'});
        await loadFutures();
    } catch(e) {
        showError('–ù–µ –≤–¥–∞–ª–æ—Å—å –≤–∏–¥–∞–ª–∏—Ç–∏: ' + e.message);
    }
}

function toggleAddForm() {
    const form = document.getElementById('addForm');
    form.classList.toggle('show');
    if (form.classList.contains('show')) {
        document.getElementById('newName').focus();
    }
}

async function saveFuture() {
    const name = document.getElementById('newName').value.trim();
    const keywords = document.getElementById('newKeywords').value.trim();
    const logic = document.getElementById('newLogic').value.trim();
    const desc = document.getElementById('newDesc').value.trim();

    if (!name || !keywords || !logic) {
        showError('–ù–∞–∑–≤–∞, –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ —ñ –ª–æ–≥—ñ–∫–∞ ‚Äî –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è');
        return;
    }

    try {
        const resp = await fetch(`${API}/api/futures`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                name,
                keywords: keywords.split(',').map(k => k.trim()).filter(Boolean),
                core_logic: logic,
                description: desc,
            }),
        });
        if (!resp.ok) {
            const err = await resp.json();
            throw new Error(err.error || '–ø–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è');
        }
        // Clear form
        ['newName','newKeywords','newLogic','newDesc'].forEach(id => {
            document.getElementById(id).value = '';
        });
        document.getElementById('addForm').classList.remove('show');
        await loadFutures();
    } catch(e) {
        showError('–ù–µ –≤–¥–∞–ª–æ—Å—å –∑–±–µ—Ä–µ–≥—Ç–∏: ' + e.message);
    }
}



// ‚îÄ‚îÄ Probability Chart ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const CHART_COLORS = [
    '#5fb8ff', '#e0b84a', '#50ffaa', '#ff6060',
    '#c084fc', '#fb923c', '#34d399', '#f472b6',
];

let hiddenSeries = new Set();

function renderChart(chartData) {
    if (!chartData || !chartData.labels || !chartData.labels.length) return;

    const canvas = document.getElementById('probabilityChart');
    const ctx = canvas.getContext('2d');

    // HiDPI
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.parentElement.getBoundingClientRect();
    const W = rect.width - 32;
    const H = 220;
    canvas.width = W * dpr;
    canvas.height = H * dpr;
    canvas.style.width = W + 'px';
    canvas.style.height = H + 'px';
    ctx.scale(dpr, dpr);

    const labels = chartData.labels;
    const series = chartData.series;
    const names = Object.keys(series);

    const PAD = { top: 16, right: 16, bottom: 32, left: 42 };
    const cW = W - PAD.left - PAD.right;
    const cH = H - PAD.top - PAD.bottom;

    // Clear
    ctx.clearRect(0, 0, W, H);

    // Grid lines
    ctx.strokeStyle = 'rgba(37,45,61,0.8)';
    ctx.lineWidth = 1;
    [0, 25, 50, 75, 100].forEach(v => {
        const y = PAD.top + cH - (v / 100) * cH;
        ctx.beginPath();
        ctx.moveTo(PAD.left, y);
        ctx.lineTo(PAD.left + cW, y);
        ctx.stroke();
        ctx.fillStyle = '#8896b0';
        ctx.font = '9px Share Tech Mono, monospace';
        ctx.textAlign = 'right';
        ctx.fillText(v + '%', PAD.left - 6, y + 3);
    });

    // X axis labels
    ctx.fillStyle = '#8896b0';
    ctx.font = '9px Share Tech Mono, monospace';
    ctx.textAlign = 'center';
    labels.forEach((l, i) => {
        const x = PAD.left + (i / Math.max(labels.length - 1, 1)) * cW;
        ctx.fillText(l, x, H - PAD.bottom + 14);
    });

    // X axis label
    ctx.fillStyle = '#5a6070';
    ctx.font = '9px Share Tech Mono, monospace';
    ctx.textAlign = 'center';
    ctx.fillText('—ñ—Ç–µ—Ä–∞—Ü—ñ—è', PAD.left + cW / 2, H - 4);

    // Lines
    names.forEach((name, ni) => {
        if (hiddenSeries.has(name)) return;
        const vals = series[name];
        const color = CHART_COLORS[ni % CHART_COLORS.length];

        ctx.beginPath();
        ctx.strokeStyle = color;
        ctx.lineWidth = 1.5;
        ctx.lineJoin = 'round';

        vals.forEach((v, i) => {
            const x = PAD.left + (i / Math.max(labels.length - 1, 1)) * cW;
            const y = PAD.top + cH - (v / 100) * cH;
            i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        });
        ctx.stroke();

        // Dots at each point
        vals.forEach((v, i) => {
            const x = PAD.left + (i / Math.max(labels.length - 1, 1)) * cW;
            const y = PAD.top + cH - (v / 100) * cH;
            ctx.beginPath();
            ctx.arc(x, y, 3, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
        });
    });

    // Legend
    const legend = document.getElementById('chartLegend');
    legend.innerHTML = names.map((name, ni) => {
        const color = CHART_COLORS[ni % CHART_COLORS.length];
        const hidden = hiddenSeries.has(name);
        return `<div class="legend-item ${hidden ? 'dim' : ''}"
                     onclick="toggleChartSeries('${name}', ${ni})"
                     style="${hidden ? 'opacity:0.35' : ''}">
            <div class="legend-dot" style="background:${color}"></div>
            <span>${esc(name)}</span>
        </div>`;
    }).join('');

    document.getElementById('chartIterCount').textContent =
        `${labels.length} —ñ—Ç–µ—Ä–∞—Ü—ñ–π`;
}

function toggleChartSeries(name) {
    if (hiddenSeries.has(name)) {
        hiddenSeries.delete(name);
    } else {
        hiddenSeries.add(name);
    }
    if (window._lastChartData) renderChart(window._lastChartData);
}



// ‚îÄ‚îÄ Mode switching ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchMode(mode) {
    const isBattle = mode === 'battle';
    document.getElementById('tabSimulate').classList.toggle('active', !isBattle);
    document.getElementById('tabBattle').classList.toggle('active', isBattle);
    document.getElementById('simulateSection').classList.toggle('hide', isBattle);
    document.getElementById('battleSection').classList.toggle('show', isBattle);
}

// ‚îÄ‚îÄ Battle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let hiddenBattleSeries = new Set();

async function runBattle() {
    const argA = document.getElementById('argA').value.trim();
    const argB = document.getElementById('argB').value.trim();
    if (!argA || !argB) {
        showBattleError('–í–≤–µ–¥—ñ—Ç—å –æ–±–∏–¥–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∏');
        return;
    }

    const rounds = parseInt(document.getElementById('battleRounds').value);
    const useField = document.getElementById('battleUseField').checked;

    setBattleLoading(true);
    hideBattleError();
    document.getElementById('battleResults').style.display = 'none';

    try {
        const resp = await fetch(`${API}/api/battle`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                argument_a: argA,
                argument_b: argB,
                rounds,
                use_field: useField,
                temperature: parseFloat(document.getElementById('battleTempRange').value),
            }),
        });
        if (!resp.ok) {
            const err = await resp.json();
            throw new Error(err.error || `HTTP ${resp.status}`);
        }
        const data = await resp.json();
        renderBattleResults(data);
    } catch(e) {
        showBattleError(e.message);
    } finally {
        setBattleLoading(false);
    }
}

function renderBattleResults(data) {
    const winner = data.winner;
    const winnerArg = data.winner_argument;
    const dominant = data.dominant_future;

    // Verdict
    const verdict = document.getElementById('battleVerdict');
    verdict.innerHTML = `
        <div class="battle-winner-label">–ø–µ—Ä–µ–º–æ–∂–µ—Ü—å ¬∑ –¥–æ–º—ñ–Ω–∞–Ω—Ç–Ω–µ –º–∞–π–±—É—Ç–Ω—î: ${esc(dominant)}</div>
        <div class="battle-winner-arg ${winner.toLowerCase()}">${esc(winnerArg)}</div>
        <div class="battle-winner-sub">–∞—Ä–≥—É–º–µ–Ω—Ç ${winner} —Ä–µ–∑–æ–Ω—É—î —Å–∏–ª—å–Ω—ñ—à–µ –∑ –ø–æ–ª–µ–º</div>
    `;

    // VS display
    const vs = document.getElementById('battleVs');
    const argA = document.getElementById('argA').value.trim();
    const argB = document.getElementById('argB').value.trim();
    vs.innerHTML = `
        <div class="battle-side ${winner === 'A' ? 'winner' : ''}">
            <div class="battle-side-label a">A ${winner === 'A' ? 'üèÜ' : ''}</div>
            <div class="battle-side-text">${esc(argA)}</div>
        </div>
        <div class="battle-vs-divider">vs</div>
        <div class="battle-side ${winner === 'B' ? 'winner' : ''}">
            <div class="battle-side-label b">B ${winner === 'B' ? 'üèÜ' : ''}</div>
            <div class="battle-side-text">${esc(argB)}</div>
        </div>
    `;

    // Chart
    if (data.chart_data) {
        window._lastBattleChartData = data.chart_data;
        hiddenBattleSeries = new Set();
        renderBattleChart(data.chart_data);
    }

    document.getElementById('battleResults').style.display = 'block';
}

function renderBattleChart(chartData) {
    const canvas = document.getElementById('battleChart');
    const ctx = canvas.getContext('2d');
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.parentElement.getBoundingClientRect();
    const W = rect.width - 32;
    const H = 220;
    canvas.width = W * dpr;
    canvas.height = H * dpr;
    canvas.style.width = W + 'px';
    canvas.style.height = H + 'px';
    ctx.scale(dpr, dpr);

    const labels = chartData.labels;
    const series = chartData.series;
    const names = Object.keys(series);
    const PAD = { top: 16, right: 16, bottom: 32, left: 42 };
    const cW = W - PAD.left - PAD.right;
    const cH = H - PAD.top - PAD.bottom;

    ctx.clearRect(0, 0, W, H);

    // Grid
    ctx.strokeStyle = 'rgba(37,45,61,0.8)';
    ctx.lineWidth = 1;
    [0, 25, 50, 75, 100].forEach(v => {
        const y = PAD.top + cH - (v / 100) * cH;
        ctx.beginPath();
        ctx.moveTo(PAD.left, y);
        ctx.lineTo(PAD.left + cW, y);
        ctx.stroke();
        ctx.fillStyle = '#8896b0';
        ctx.font = '9px Share Tech Mono, monospace';
        ctx.textAlign = 'right';
        ctx.fillText(v + '%', PAD.left - 6, y + 3);
    });

    // X labels ‚Äî show every other to avoid crowding
    ctx.fillStyle = '#8896b0';
    ctx.font = '9px Share Tech Mono, monospace';
    ctx.textAlign = 'center';
    labels.forEach((l, i) => {
        if (i % 2 === 0) {
            const x = PAD.left + (i / Math.max(labels.length - 1, 1)) * cW;
            ctx.fillText(l, x, H - PAD.bottom + 14);
        }
    });

    // Vertical dividers between rounds (between A and B)
    ctx.strokeStyle = 'rgba(58,69,96,0.4)';
    ctx.lineWidth = 0.5;
    labels.forEach((l, i) => {
        if (l.endsWith('B') && i < labels.length - 1) {
            const x = PAD.left + ((i + 0.5) / Math.max(labels.length - 1, 1)) * cW;
            ctx.beginPath();
            ctx.moveTo(x, PAD.top);
            ctx.lineTo(x, PAD.top + cH);
            ctx.stroke();
        }
    });

    // Lines
    names.forEach((name, ni) => {
        if (hiddenBattleSeries.has(name)) return;
        const vals = series[name];
        const color = CHART_COLORS[ni % CHART_COLORS.length];
        ctx.beginPath();
        ctx.strokeStyle = color;
        ctx.lineWidth = 1.5;
        ctx.lineJoin = 'round';
        vals.forEach((v, i) => {
            const x = PAD.left + (i / Math.max(labels.length - 1, 1)) * cW;
            const y = PAD.top + cH - (v / 100) * cH;
            i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        });
        ctx.stroke();
        vals.forEach((v, i) => {
            const x = PAD.left + (i / Math.max(labels.length - 1, 1)) * cW;
            const y = PAD.top + cH - (v / 100) * cH;
            ctx.beginPath();
            ctx.arc(x, y, 2.5, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
        });
    });

    // Legend
    const legend = document.getElementById('battleLegend');
    legend.innerHTML = names.map((name, ni) => {
        const color = CHART_COLORS[ni % CHART_COLORS.length];
        const hidden = hiddenBattleSeries.has(name);
        return `<div class="legend-item" onclick="toggleBattleSeries('${name}')"
                     style="${hidden ? 'opacity:0.35' : ''}">
            <div class="legend-dot" style="background:${color}"></div>
            <span>${esc(name)}</span>
        </div>`;
    }).join('');

    document.getElementById('battleChartInfo').textContent =
        `${labels.length / 2} —Ä–∞—É–Ω–¥—ñ–≤ ¬∑ ${labels.length} —Ç–æ—á–æ–∫`;
}

function toggleBattleSeries(name) {
    hiddenBattleSeries.has(name)
        ? hiddenBattleSeries.delete(name)
        : hiddenBattleSeries.add(name);
    if (window._lastBattleChartData) renderBattleChart(window._lastBattleChartData);
}

function setBattleLoading(on) {
    document.getElementById('battleLoading').classList.toggle('show', on);
    document.getElementById('btnBattle').disabled = on;
}

function showBattleError(msg) {
    const el = document.getElementById('battleError');
    el.textContent = '‚ö† ' + msg;
    el.classList.add('show');
}

function hideBattleError() {
    document.getElementById('battleError').classList.remove('show');
}



// ‚îÄ‚îÄ Temperature control ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TEMP_LEVELS = [
    { max: 0.3, label: '–∑–∞–º–æ—Ä–æ–∂–µ–Ω–æ ¬∑ ', color: '#a0c4ff',
      text: '–ú–∞–π–∂–µ –ø–æ–≤–Ω–∏–π –¥–µ—Ç–µ—Ä–º—ñ–Ω—ñ–∑–º. –ù–∞–π—Å–∏–ª—å–Ω—ñ—à–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç –ø–µ—Ä–µ–º–∞–≥–∞—î –∑–∞–≤–∂–¥–∏. –í–∏–ø–∞–¥–∫–æ–≤–æ—Å—Ç—ñ –º–∞–π–∂–µ –Ω–µ–º–∞—î ‚Äî —è–∫ —É —Ç–æ—Ç–∞–ª—ñ—Ç–∞—Ä–Ω—ñ–π —Å–∏—Å—Ç–µ–º—ñ –¥–µ –æ–¥–∏–Ω –≥–æ–ª–æ—Å –≤–∏—Ä—ñ—à—É—î –≤—Å–µ.' },
    { max: 0.6, label: '—Ö–æ–ª–æ–¥–Ω–∞ ¬∑ ', color: '#7ab8f5',
      text: '–ù–∏–∑—å–∫–∞ –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ—Å—Ç—å. –°–∏–ª—å–Ω—ñ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –¥–æ–º—ñ–Ω—É—é—Ç—å –Ω–∞–¥—ñ–π–Ω–æ. –°–ª–∞–±–∫—ñ ‚Äî –º–∞–π–∂–µ –Ω–µ –º–∞—é—Ç—å —à–∞–Ω—Å—É. –†–µ–∞–ª—å–Ω—ñ—Å—Ç—å "—Å–ª—É—Ö–∞—î—Ç—å—Å—è" –ª–æ–≥—ñ–∫–∏.' },
    { max: 0.9, label: '–ø—Ä–æ—Ö–æ–ª–æ–¥–Ω–∞ ¬∑ ', color: '#5fb8ff',
      text: '–ü–æ–º—ñ—Ä–Ω–∞ –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ—Å—Ç—å. –°–∏–ª—å–Ω–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç —à–≤–∏–¥—à–µ –∑–∞ –≤—Å–µ –ø–µ—Ä–µ–º–æ–∂–µ, –∞–ª–µ —Å—é—Ä–ø—Ä–∏–∑–∏ –º–æ–∂–ª–∏–≤—ñ.' },
    { max: 1.1, label: '–Ω–æ—Ä–º–∞–ª—å–Ω–∞ ¬∑ ', color: '#5fb8ff',
      text: '–ê—Ä–≥—É–º–µ–Ω—Ç–∏ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –°–∏–ª—å–Ω–∏–π –Ω–∞—Ä–∞—Ç–∏–≤ –ø–µ—Ä–µ–º–∞–≥–∞—î, –∞–ª–µ –≤–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è ‚Äî —è–∫ —É —Ä–µ–∞–ª—å–Ω–æ–º—É –∂–∏—Ç—Ç—ñ.' },
    { max: 1.4, label: '—Ç–µ–ø–ª–∞ ¬∑ ', color: '#e0b84a',
      text: '–ü—ñ–¥–≤–∏—â–µ–Ω–∞ –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ—Å—Ç—å. –°–ª–∞–±–∫—ñ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –æ—Ç—Ä–∏–º—É—é—Ç—å –≤–∏–ø–∞–¥–∫–æ–≤—ñ —à–∞–Ω—Å–∏. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –º–µ–Ω—à –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ ‚Äî —è–∫ —É –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–∏—Ö —Å—É—Å–ø—ñ–ª—å—Å—Ç–≤–∞—Ö.' },
    { max: 1.7, label: '–≥–∞—Ä—è—á–∞ ¬∑ ', color: '#fb923c',
      text: '–í–∏—Å–æ–∫–∞ —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω—ñ—Å—Ç—å. –õ–æ–≥—ñ–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ —Ä–æ–∑–º–∏–≤–∞—î—Ç—å—Å—è. –ë—É–¥—å-—è–∫–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π –º–æ–∂–µ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏—Å—å –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å–∏–ª–∏ –Ω–∞—Ä–∞—Ç–∏–≤—É.' },
    { max: 2.1, label: '—Ö–∞–æ—Å ¬∑ ', color: '#ff6060',
      text: '–ü–æ–≤–Ω–∏–π —Ö–∞–æ—Å. –ê—Ä–≥—É–º–µ–Ω—Ç–∏ –º–∞–π–∂–µ –Ω–µ –º–∞—é—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è ‚Äî —Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—å –æ–±–∏—Ä–∞—î –≤–∏–ø–∞–¥–∫–æ–≤–æ. –Ø–∫ –ø—ñ–¥ —á–∞—Å —Ä–µ–≤–æ–ª—é—Ü—ñ–π –∞–±–æ –∫–æ–ª–∞–ø—Å—É —Å–∏—Å—Ç–µ–º–∏.' },
];

function getTempLevel(val) {
    return TEMP_LEVELS.find(l => val <= l.max) || TEMP_LEVELS[TEMP_LEVELS.length - 1];
}

function updateTemp(val) {
    val = parseFloat(val);
    const level = getTempLevel(val);
    const display = document.getElementById('tempDisplay');
    const expl = document.getElementById('tempExplanation');
    const slider = document.getElementById('tempRange');

    display.textContent = level.label + val.toFixed(1);
    display.style.color = level.color;
    expl.textContent = level.text;
    expl.style.borderLeftColor = level.color;

    // Color the slider track
    const pct = ((val - 0.1) / (2.0 - 0.1)) * 100;
    slider.style.background = `linear-gradient(to right, ${level.color} ${pct}%, var(--dim) ${pct}%)`;
}

function updateBattleTemp(val) {
    val = parseFloat(val);
    const level = getTempLevel(val);
    const display = document.getElementById('battleTempDisplay');
    const expl = document.getElementById('battleTempExplanation');
    const slider = document.getElementById('battleTempRange');

    display.textContent = level.label + val.toFixed(1);
    display.style.color = level.color;
    expl.textContent = level.text;
    expl.style.borderLeftColor = level.color;

    const pct = ((val - 0.1) / (2.0 - 0.1)) * 100;
    slider.style.background = `linear-gradient(to right, ${level.color} ${pct}%, var(--dim) ${pct}%)`;
}

// Init sliders on load
document.addEventListener('DOMContentLoaded', () => {
    updateTemp(1.0);
    updateBattleTemp(1.0);
});

</script>
</body>
</html>
